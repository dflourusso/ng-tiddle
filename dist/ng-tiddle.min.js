(function(){var e,t,i,r,n,o;e=function(){function e(){return["ngCookies"]}return e}(),angular.module("ng-tiddle",new e),o=function(){function e(e){e.interceptors.push("NgTiddleInterceptor")}return e}(),angular.module("ng-tiddle").config(["$httpProvider",o]),i=function(){function e(e,t,i){return{request:function(e){var r,n;return t.getResource()&&(n=i.getSignInStrategy(),r=i.getModelName(),e.headers[("X-"+r+"-"+n).toUpperCase()]=t.getResource()[n],e.headers[("X-"+r+"-TOKEN").toUpperCase()]=t.getToken()),e},responseError:function(r){return 401===r.status&&(t.clear(),i.onUnauthorized()),e.reject(r)}}}return e}(),angular.module("ng-tiddle").factory("NgTiddleInterceptor",["$q","ngTiddleSessionService","ngTiddleAuthProvider",i]),t=function(){function e(){this.properties={api_root:"http://localhost:3000/",model_name:"user",sign_in_strategy:"email",api_resource_path:"users",keep_logged_in:!1},this.$get=function(){var e;return e=this.properties,{getApiRoot:function(){return e.api_root},setApiRoot:function(t){return e.api_root=t},getModelName:function(){return e.model_name},setModelName:function(t){return e.model_name=t},getSignInStrategy:function(){return e.sign_in_strategy},setSignInStrategy:function(t){return e.sign_in_strategy=t},getApiResourcePath:function(){return e.api_resource_path},setApiResourcePath:function(t){return e.api_resource_path=t},getKeepLoggedIn:function(){return e.keep_logged_in},setKeepLoggedIn:function(t){return e.keep_logged_in=t},onUnauthorized:function(){return console.warn("No unauthorized callback was defined")},onAuthorize:function(e){return console.info("No authorize callback was defined",e)}}}}return e}(),angular.module("ng-tiddle").provider("ngTiddleAuthProvider",[t]),t=function(){function e(e,t,i,r){this.$http=e,this.$timeout=t,this.ngTiddleSessionService=i,this.ngTiddleAuthProvider=r,this.sign_in_params={}}return e.prototype.signIn=function(e){var t,i;return t=this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_in",this.sign_in_params[this.tap.getModelName()]=e,i=this.$http.post(t,this.sign_in_params),i.then(function(e){return function(t){return e.ngTiddleSessionService.setResource(t.data[e.tap.getModelName()],t.data.authentication_token),e.$timeout(function(){return e.tap.onAuthorize(t.data)},0)}}(this)),i},e.prototype.signOut=function(){return this.$http["delete"](this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_out").then(function(e){return function(){return e.ngTiddleSessionService.clear(),e.$timeout(function(){return e.tap.onUnauthorized()},0)}}(this))},e.prototype.getResource=function(){return this.ngTiddleSessionService.getResource()},e}(),angular.module("ng-tiddle").service("ngTiddleAuthService",["$http","$timeout","ngTiddleSessionService","ngTiddleAuthProvider",t]),r=function(){function e(e,t){this.ngTiddleStorageService=e,this.ngTiddleAuthProvider=t}return e.prototype.token_prefix="tiddle_token",e.prototype.resource_prefix="tiddle_resource",e.prototype.setResource=function(e,t){return e?(this.ngTiddleStorageService.put(this.token_prefix,t),this.ngTiddleStorageService.put(this.resource_prefix,e),this.resource=e):void this.clear()},e.prototype.getResource=function(){return this.ngTiddleStorageService.get(this.resource_prefix)?this.resource=this.ngTiddleStorageService.get(this.resource_prefix):void this.ngTiddleAuthProvider.onUnauthorized()},e.prototype.getToken=function(){return this.ngTiddleStorageService.get(this.token_prefix)},e.prototype.clear=function(){return this.ngTiddleStorageService.remove(this.resource_prefix),this.ngTiddleStorageService.remove(this.token_prefix),this.resource=null},e}(),angular.module("ng-tiddle").service("ngTiddleSessionService",["ngTiddleStorageService","ngTiddleAuthProvider",r]),n=function(){function e(e,t){this.ngTiddleAuthProvider=e,this.$cookies=t}return e.prototype.isLocalStorage=function(){return window.cordova||window.NATIVE?!0:window.localStorage&&this.ngTiddleAuthProvider.getKeepLoggedIn()?!0:void 0},e.prototype.put=function(e,t){return this.isLocalStorage()?void(window.localStorage[e]=JSON.stringify(t)):this.$cookies.putObject(e,t)},e.prototype.get=function(e){var t;return this.isLocalStorage()?(t=window.localStorage[e])?JSON.parse(t):void 0:this.$cookies.getObject(e)},e.prototype.remove=function(e){return this.isLocalStorage()?void delete window.localStorage[e]:this.$cookies.remove(e)},e}(),angular.module("ng-tiddle").service("ngTiddleStorageService",["ngTiddleAuthProvider","$cookies",n])}).call(this);