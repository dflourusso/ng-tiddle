(function(){var e,t,n,r,i,o;t=function(){function e(){return[]}return e}(),angular.module("ng-tiddle",new t),o=function(){function e(e){e.interceptors.push("NgTiddleInterceptor")}return e}(),angular.module("ng-tiddle").config(["$httpProvider",o]),r=function(){function e(e,t,n){var r;return r=n.getSignInStrategy(),{request:function(e){var i;return t.getResource()&&(i=n.getModelName(),e.headers[("X-"+i+"-"+r).toUpperCase()]=t.getResource()[r],e.headers[("X-"+i+"-TOKEN").toUpperCase()]=t.getToken()),e},responseError:function(t){return function(t){return 401===t.status&&n.onUnauthorized(),e.reject(t)}}(this)}}return e}(),angular.module("ng-tiddle").factory("NgTiddleInterceptor",["$q","ngTiddleSessionService","ngTiddleAuthProvider",r]),n=function(){function e(){this.api_root="http://localhost:3000/",this.model_name="user",this.sign_in_strategy="email",this.api_resource_path="users",this.$get=function(){return{getApiRoot:function(e){return function(){return e.api_root}}(this),setApiRoot:function(e){return function(t){return e.api_root=t}}(this),getModelName:function(e){return function(){return e.model_name}}(this),setModelName:function(e){return function(t){return e.model_name=t}}(this),getSignInStrategy:function(e){return function(){return e.sign_in_strategy}}(this),setSignInStrategy:function(e){return function(t){return e.sign_in_strategy=t}}(this),getApiResourcePath:function(e){return function(){return e.api_resource_path}}(this),setApiResourcePath:function(e){return function(t){return e.api_resource_path=t}}(this),onUnauthorized:function(){return console.warn("No unauthorized callback was defined")},onAuthorize:function(e){return console.info("No authorize callback was defined",e)}}}}return e}(),angular.module("ng-tiddle").provider("ngTiddleAuthProvider",[n]),n=function(){function e(e,t,n){this.$http=e,this.ngTiddleSessionService=t,this.tap=n,this.sign_in_params={}}return e.prototype.signIn=function(e){var t,n;return t=this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_in",this.sign_in_params[this.tap.getModelName()]=e,n=this.$http.post(t,this.sign_in_params),n.then(function(e){return function(t){return e.ngTiddleSessionService.setResource(t.data[e.tap.getModelName()],t.data.authentication_token),e.tap.onAuthorize(t.data)}}(this)),n},e.prototype.signOut=function(){return this.$http["delete"](this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_out").then(function(e){return function(){return e.ngTiddleSessionService.clear(),e.tap.onUnauthorized()}}(this))},e}(),angular.module("ng-tiddle").service("ngTiddleAuthService",["$http","ngTiddleSessionService","ngTiddleAuthProvider",n]),i=function(){function e(e,t){this.kvStorageService=e,this.ngTiddleAuthProvider=t}return e.prototype.setResource=function(e,t){if(!e)return void this.clear();try{this.kvStorageService.tiddle_token=t}catch(n){}return this.kvStorageService.tiddle_resource=JSON.stringify(e),this.resource=e},e.prototype.getResource=function(){return this.kvStorageService.tiddle_resource?this.resource=JSON.parse(this.kvStorageService.tiddle_resource):void this.ngTiddleAuthProvider.onUnauthorized()},e.prototype.getToken=function(){return this.kvStorageService.tiddle_token},e.prototype.clear=function(){try{return delete this.kvStorageService.tiddle_resource,delete this.kvStorageService.tiddle_token,this.resource=void 0}catch(e){}},e}(),angular.module("ng-tiddle").service("ngTiddleSessionService",["kvStorageService","ngTiddleAuthProvider",i]),e=function(){function e(){return window.cordova||window.NATIVE?window.localStorage:window.localStorage?window.localStorage:window.sessionStorage?window.sessionStorage:{clear:function(){}}}return e}(),angular.module("ng-tiddle").service("kvStorageService",[e])}).call(this);