(function(){var e,t,r,n,i,o;t=function(){function e(){return[]}return e}(),angular.module("ng-tiddle",new t),o=function(){function e(e){e.interceptors.push("NgTiddleInterceptor")}return e}(),angular.module("ng-tiddle").config(["$httpProvider",o]),n=function(){function e(e,t,r){return{request:function(e){var n,i;return t.getResource()&&(i=r.getSignInStrategy(),n=r.getModelName(),e.headers[("X-"+n+"-"+i).toUpperCase()]=t.getResource()[i],e.headers[("X-"+n+"-TOKEN").toUpperCase()]=t.getToken()),e},responseError:function(n){return 401===n.status&&(t.clear(),r.onUnauthorized()),e.reject(n)}}}return e}(),angular.module("ng-tiddle").factory("NgTiddleInterceptor",["$q","ngTiddleSessionService","ngTiddleAuthProvider",n]),r=function(){function e(){this.properties={api_root:"http://localhost:3000/",model_name:"user",sign_in_strategy:"email",api_resource_path:"users"},this.$get=function(){var e;return e=this.properties,{getApiRoot:function(){return e.api_root},setApiRoot:function(t){return e.api_root=t},getModelName:function(){return e.model_name},setModelName:function(t){return e.model_name=t},getSignInStrategy:function(){return e.sign_in_strategy},setSignInStrategy:function(t){return e.sign_in_strategy=t},getApiResourcePath:function(){return e.api_resource_path},setApiResourcePath:function(t){return e.api_resource_path=t},onUnauthorized:function(){return console.warn("No unauthorized callback was defined")},onAuthorize:function(e){return console.info("No authorize callback was defined",e)}}}}return e}(),angular.module("ng-tiddle").provider("ngTiddleAuthProvider",[r]),r=function(){function e(e,t,r){this.$http=e,this.ngTiddleSessionService=t,this.tap=r,this.sign_in_params={}}return e.prototype.signIn=function(e){var t,r;return t=this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_in",this.sign_in_params[this.tap.getModelName()]=e,r=this.$http.post(t,this.sign_in_params),r.then(function(e){return function(t){return e.ngTiddleSessionService.setResource(t.data[e.tap.getModelName()],t.data.authentication_token),e.tap.onAuthorize(t.data)}}(this)),r},e.prototype.signOut=function(){return this.$http["delete"](this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_out").then(function(e){return function(){return e.ngTiddleSessionService.clear(),e.tap.onUnauthorized()}}(this))},e.prototype.getResource=function(){return this.ngTiddleSessionService.getResource()},e}(),angular.module("ng-tiddle").service("ngTiddleAuthService",["$http","ngTiddleSessionService","ngTiddleAuthProvider",r]),i=function(){function e(e,t){this.kvStorageService=e,this.ngTiddleAuthProvider=t}return e.prototype.setResource=function(e,t){if(!e)return void this.clear();try{this.kvStorageService.tiddle_token=t}catch(r){}return this.kvStorageService.tiddle_resource=JSON.stringify(e),this.resource=e},e.prototype.getResource=function(){return this.kvStorageService.tiddle_resource?this.resource=JSON.parse(this.kvStorageService.tiddle_resource):void this.ngTiddleAuthProvider.onUnauthorized()},e.prototype.getToken=function(){return this.kvStorageService.tiddle_token},e.prototype.clear=function(){try{return delete this.kvStorageService.tiddle_resource,delete this.kvStorageService.tiddle_token,this.resource=null}catch(e){}},e}(),angular.module("ng-tiddle").service("ngTiddleSessionService",["kvStorageService","ngTiddleAuthProvider",i]),e=function(){function e(){return window.cordova||window.NATIVE?window.localStorage:window.localStorage?window.localStorage:window.sessionStorage?window.sessionStorage:{clear:function(){}}}return e}(),angular.module("ng-tiddle").service("kvStorageService",[e])}).call(this);