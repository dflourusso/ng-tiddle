(function(){var e,t,r,i,n,o;e=function(){function e(){return["ngCookies"]}return e}(),angular.module("ng-tiddle",new e),o=function(){function e(e){e.interceptors.push("NgTiddleInterceptor")}return e}(),angular.module("ng-tiddle").config(["$httpProvider",o]),t=function(){function e(){this.properties={api_root:"http://localhost:3000/",model_name:"user",sign_in_strategy:"email",api_resource_path:"users",keep_logged_in:!1},this.$get=function(){var e;return e=this.properties,{getApiRoot:function(){return e.api_root},setApiRoot:function(t){return e.api_root=t},getModelName:function(){return e.model_name},setModelName:function(t){return e.model_name=t},getSignInStrategy:function(){return e.sign_in_strategy},setSignInStrategy:function(t){return e.sign_in_strategy=t},getApiResourcePath:function(){return e.api_resource_path},setApiResourcePath:function(t){return e.api_resource_path=t},getKeepLoggedIn:function(){return e.keep_logged_in},setKeepLoggedIn:function(t){return e.keep_logged_in=t},onUnauthorized:function(){return console.warn("No unauthorized callback was defined")},onAuthorize:function(e){return console.info("No authorize callback was defined",e)}}}}return e}(),angular.module("ng-tiddle").provider("ngTiddleAuthProvider",[t]),t=function(){function e(e,t,r,i){this.$http=e,this.$timeout=t,this.ngTiddleSessionService=r,this.tap=i,this.sign_in_params={}}return e.prototype.signIn=function(e){var t,r;return t=this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_in",this.sign_in_params[this.tap.getModelName()]=e,r=this.$http.post(t,this.sign_in_params),r.then(function(e){return function(t){return e.ngTiddleSessionService.setResource(t.data[e.tap.getModelName()],t.data.authentication_token),e.$timeout(function(){return e.tap.onAuthorize(t.data)},0)}}(this)),r},e.prototype.signOut=function(){return this.$http["delete"](this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_out").then(function(e){return function(){return e.ngTiddleSessionService.clear(),e.$timeout(function(){return e.tap.onUnauthorized()},0)}}(this))},e.prototype.getResource=function(){return this.ngTiddleSessionService.getResource()},e}(),angular.module("ng-tiddle").service("ngTiddleAuthService",["$http","$timeout","ngTiddleSessionService","ngTiddleAuthProvider",t]),i=function(){function e(e,t,r){this.$timeout=e,this.ngTiddleStorageService=t,this.ngTiddleAuthProvider=r}return e.prototype.token_prefix="tiddle_token",e.prototype.resource_prefix="tiddle_resource",e.prototype.setResource=function(e,t){return e?(this.ngTiddleStorageService.put(this.token_prefix,t),this.ngTiddleStorageService.put(this.resource_prefix,e),this.resource=e):void this.clear()},e.prototype.getResource=function(){return this.resource=this.ngTiddleStorageService.get(this.resource_prefix),this.resource||this.$timeout(function(e){return function(){return e.ngTiddleAuthProvider.onUnauthorized()}}(this),0),this.resource},e.prototype.getToken=function(){return this.ngTiddleStorageService.get(this.token_prefix)},e.prototype.clear=function(){return this.ngTiddleStorageService.remove(this.resource_prefix),this.ngTiddleStorageService.remove(this.token_prefix),this.resource=null},e}(),angular.module("ng-tiddle").service("ngTiddleSessionService",["$timeout","ngTiddleStorageService","ngTiddleAuthProvider",i]),r=function(){function e(e,t,r,i,n){return{request:function(e){var t,o,u,s;return t=new RegExp(i.getApiRoot().match("^(?:https?:)?(?://)?([^/?]+)")[1]),o=n.get("tiddle_resource"),t.test(e.url)&&o&&(s=i.getSignInStrategy(),u=i.getModelName(),e.headers[("X-"+u+"-"+s).toUpperCase()]=o[s],e.headers[("X-"+u+"-TOKEN").toUpperCase()]=r.getToken()),e},responseError:function(n){return 401===n.status&&(r.clear(),t(function(e){return function(){return i.onUnauthorized()}}(this),0)),e.reject(n)}}}return e}(),angular.module("ng-tiddle").factory("NgTiddleInterceptor",["$q","$timeout","ngTiddleSessionService","ngTiddleAuthProvider","ngTiddleStorageService",r]),n=function(){function e(e,t){this.ngTiddleAuthProvider=e,this.$cookies=t}return e.prototype.isLocalStorage=function(){return window.localStorage&&this.ngTiddleAuthProvider.getKeepLoggedIn()},e.prototype.put=function(e,t){return this.isLocalStorage()?void(window.localStorage[e]=JSON.stringify(t)):this.$cookies.putObject(e,t)},e.prototype.get=function(e){var t;return this.isLocalStorage()?(t=window.localStorage[e])?JSON.parse(t):void 0:this.$cookies.getObject(e)},e.prototype.remove=function(e){return this.isLocalStorage()?void delete window.localStorage[e]:this.$cookies.remove(e)},e}(),angular.module("ng-tiddle").service("ngTiddleStorageService",["ngTiddleAuthProvider","$cookies",n])}).call(this);