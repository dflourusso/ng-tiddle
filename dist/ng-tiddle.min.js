(function(){var t,e,n,r,i,o;e=function(){function t(){return[]}return t}(),angular.module("ng-tiddle",new e),o=function(){function t(t){t.interceptors.push("NgTiddleInterceptor")}return t}(),angular.module("ng-tiddle").config(["$httpProvider",o]),r=function(){function t(t,e,n){var r;return r=n.getSignInStrategy(),{request:function(t){var i;return e.getResource()&&(i=n.getModelName(),t.headers[("X-"+i+"-"+r).toUpperCase()]=e.getResource()[r],t.headers[("X-"+i+"-TOKEN").toUpperCase()]=e.getToken()),t},responseError:function(e){return function(e){return 401===e.status&&n.onUnauthorized(),t.reject(e)}}(this)}}return t}(),angular.module("ng-tiddle").factory("NgTiddleInterceptor",["$q","ngTiddleSessionService","ngTiddleAuthProvider",r]),n=function(){function t(){this.api_root="http://localhost:3000/",this.model_name="user",this.sign_in_strategy="email",this.sign_in_path="/auth/sign_in",this.return_path="/",this.api_resource_path="users",this.$get=function(t){return{getApiRoot:function(t){return function(){return t.api_root}}(this),setApiRoot:function(t){return function(e){return t.api_root=e}}(this),getModelName:function(t){return function(){return t.model_name}}(this),setModelName:function(t){return function(e){return t.model_name=e}}(this),getSignInStrategy:function(t){return function(){return t.sign_in_strategy}}(this),setSignInStrategy:function(t){return function(e){return t.sign_in_strategy=e}}(this),getSignInPath:function(t){return function(){return t.sign_in_path}}(this),setSignInPath:function(t){return function(e){return t.sign_in_path=e}}(this),getReturnPath:function(t){return function(){return t.return_path}}(this),setReturnPath:function(t){return function(e){return t.return_path=e}}(this),getApiResourcePath:function(t){return function(){return t.api_resource_path}}(this),setApiResourcePath:function(t){return function(e){return t.api_resource_path=e}}(this),onUnauthorized:function(e){return function(){return t.path(e.sign_in_path)}}(this),onAuthorize:function(e){return function(){return t.path(e.return_path)}}(this)}}}return t}(),angular.module("ng-tiddle").provider("ngTiddleAuthProvider",[n]),n=function(){function t(t,e,n){this.$http=t,this.ngTiddleSessionService=e,this.tap=n,this.sign_in_params={}}return t.prototype.signIn=function(t){var e,n;return e=this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_in",this.sign_in_params[this.tap.getModelName()]=t,n=this.$http.post(e,this.sign_in_params),n.then(function(t){return function(e){return t.ngTiddleSessionService.setResource(e.data[t.tap.getModelName()],e.data.authentication_token),t.tap.onAuthorize()}}(this)),n},t.prototype.signOut=function(){return this.$http["delete"](this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_out").then(function(t){return function(){return t.ngTiddleSessionService.clear(),t.tap.onUnauthorized()}}(this))},t}(),angular.module("ng-tiddle").service("ngTiddleAuthService",["$http","ngTiddleSessionService","ngTiddleAuthProvider",n]),i=function(){function t(t){this.kvStorageService=t}return t.prototype.setResource=function(t,e){if(!t)return void this.clear();try{this.kvStorageService.token=e}catch(n){}return this.kvStorageService.resource=JSON.stringify(t),this.resource=t},t.prototype.getResource=function(){return this.kvStorageService.resource?this.resource=JSON.parse(this.kvStorageService.resource):void 0},t.prototype.getToken=function(){return this.kvStorageService.token},t.prototype.clear=function(){try{return delete this.kvStorageService.resource,delete this.kvStorageService.token,this.resource=void 0}catch(t){}},t}(),angular.module("ng-tiddle").service("ngTiddleSessionService",["kvStorageService",i]),t=function(){function t(){return window.cordova||window.NATIVE?window.localStorage:window.localStorage?window.localStorage:window.sessionStorage?window.sessionStorage:{clear:function(){}}}return t}(),angular.module("ng-tiddle").service("kvStorageService",[t])}).call(this);