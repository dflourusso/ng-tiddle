(function(){var e,t,r,o,i,n;t=function(){function e(){return["ngCookies"]}return e}(),angular.module("ng-tiddle",new t),n=function(){function e(e){e.interceptors.push("NgTiddleInterceptor")}return e}(),angular.module("ng-tiddle").config(["$httpProvider",n]),o=function(){function e(e,t,r){return{request:function(e){var o,i;return t.getResource()&&(i=r.getSignInStrategy(),o=r.getModelName(),e.headers[("X-"+o+"-"+i).toUpperCase()]=t.getResource()[i],e.headers[("X-"+o+"-TOKEN").toUpperCase()]=t.getToken()),e},responseError:function(o){return 401===o.status&&(t.clear(),r.onUnauthorized()),e.reject(o)}}}return e}(),angular.module("ng-tiddle").factory("NgTiddleInterceptor",["$q","ngTiddleSessionService","ngTiddleAuthProvider",o]),r=function(){function e(){this.properties={api_root:"http://localhost:3000/",model_name:"user",sign_in_strategy:"email",api_resource_path:"users",keep_logged_in:!1},this.$get=function(){var e;return e=this.properties,{getApiRoot:function(){return e.api_root},setApiRoot:function(t){return e.api_root=t},getModelName:function(){return e.model_name},setModelName:function(t){return e.model_name=t},getSignInStrategy:function(){return e.sign_in_strategy},setSignInStrategy:function(t){return e.sign_in_strategy=t},getApiResourcePath:function(){return e.api_resource_path},setApiResourcePath:function(t){return e.api_resource_path=t},getKeepLoggedIn:function(){return e.keep_logged_in},setKeepLoggedIn:function(t){return e.keep_logged_in=t},onUnauthorized:function(){return console.warn("No unauthorized callback was defined")},onAuthorize:function(e){return console.info("No authorize callback was defined",e)}}}}return e}(),angular.module("ng-tiddle").provider("ngTiddleAuthProvider",[r]),r=function(){function e(e,t,r){this.$http=e,this.ngTiddleSessionService=t,this.tap=r,this.sign_in_params={}}return e.prototype.signIn=function(e){var t,r;return t=this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_in",this.sign_in_params[this.tap.getModelName()]=e,r=this.$http.post(t,this.sign_in_params),r.then(function(e){return function(t){return e.ngTiddleSessionService.setResource(t.data[e.tap.getModelName()],t.data.authentication_token),e.tap.onAuthorize(t.data)}}(this)),r},e.prototype.signOut=function(){return this.$http["delete"](this.tap.getApiRoot()+"/"+this.tap.getApiResourcePath()+"/sign_out").then(function(e){return function(){return e.ngTiddleSessionService.clear(),e.tap.onUnauthorized()}}(this))},e.prototype.getResource=function(){return this.ngTiddleSessionService.getResource()},e}(),angular.module("ng-tiddle").service("ngTiddleAuthService",["$http","ngTiddleSessionService","ngTiddleAuthProvider",r]),i=function(){function e(e,t){this.kvStorageService=e,this.ngTiddleAuthProvider=t}return e.prototype.token_prefix="tiddle_token",e.prototype.resource_prefix="tiddle_resource",e.prototype.setResource=function(e,t){return e?(this.kvStorageService.put(this.token_prefix,t),this.kvStorageService.put(this.resource_prefix,e),this.resource=e):void this.clear()},e.prototype.getResource=function(){return this.kvStorageService.get(this.resource_prefix)?this.resource=this.kvStorageService.get(this.resource_prefix):void this.ngTiddleAuthProvider.onUnauthorized()},e.prototype.getToken=function(){return this.kvStorageService.get(this.token_prefix)},e.prototype.clear=function(){return this.kvStorageService.remove(this.resource_prefix),this.kvStorageService.remove(this.token_prefix),this.resource=null},e}(),angular.module("ng-tiddle").service("ngTiddleSessionService",["kvStorageService","ngTiddleAuthProvider",i]),e=function(){function e(e,t){this.ngTiddleAuthProvider=e,this.$cookies=t}return e.prototype.storageType=function(){return window.cordova||window.NATIVE?"localStorage":window.localStorage&&this.ngTiddleAuthProvider.getKeepLoggedIn()?"localStorage":"cookiesStorage"},e.prototype.put=function(e,t){return"localStorage"===this.storageType()?void(window.localStorage[e]=JSON.stringify(t)):this.$cookies.putObject(e,t)},e.prototype.get=function(e){var t;return"localStorage"===this.storageType()?(t=window.localStorage[e])?JSON.parse(t):void 0:this.$cookies.getObject(e)},e.prototype.remove=function(e){return"localStorage"===this.storageType()?void delete window.localStorage[e]:this.$cookies.remove(e)},e}(),angular.module("ng-tiddle").service("kvStorageService",["ngTiddleAuthProvider","$cookies",e])}).call(this);